-- A Lua Lakefile

local tInsert    = table.insert

local docDir     = 't-literate-progs/doc/context/third/literateProgs'
local moduleDir  = 't-literate-progs/tex/context/third/literateProgs'

local contextDoc = 'cd t-literate-progs/doc/context/third/literateProgs ; context literateProgs.tex'

local docFiles = {
  'literateProgs.tex',
  'overview.tex',
  'preamble.tex',
  'rendering.tex',
  'codeManipulation.tex',
  'lakefiles.tex',
  'conclusion.tex',
}

local srcFiles = {
  't-literate-progs.mkiv',
  't-literate-progs.lua',
  't-literate-progs-templates.lua',
}

-------------------------------------
-- ADD build targets for each srcFile

local buildTargets = {}

tInsert(buildTargets, target(
  'build/t-literate-progs.mkiv',
  docFiles,
  contextDoc
))

tInsert(buildTargets, target(
  'build/t-literate-progs.lua',
  docFiles,
  contextDoc
))

tInsert(buildTargets, target(
  'build/t-literate-progs-templates.lua',
  docFiles,
  contextDoc
))

------------------------------------
-- ADD diff targets for each srcFile

local diffTargets = {}

tInsert(diffTargets, target(
  'diff-t-literate-progs.mkiv',
  'build/t-literate-progs.mkiv',
  'diff build/t-literate-progs.mkiv t-literate-progs/tex/context/third/literateProgs/t-literate-progs.mkiv'
))

tInsert(diffTargets, target(
  'diff-t-literate-progs.lua',
  'build/t-literate-progs.lua',
  'diff build/t-literate-progs.lua t-literate-progs/tex/context/third/literateProgs/t-literate-progs.lua'
))

tInsert(diffTargets, target(
  'diff-t-literate-progs-templates.lua',
  'build/t-literate-progs-templates.lua',
  'diff build/t-literate-progs-templates.lua t-literate-progs/tex/context/third/literateProgs/t-literate-progs-templates.lua'
))

---------------------------------------
-- ADD install targets for each srcFile

local installTargets = {}

tInsert(installTargets, target(
  't-literate-progs/tex/context/third/literateProgs/t-literate-progs.mkiv',
  'build/t-literate-progs.mkiv',
  'cp build/t-literate-progs.mkiv t-literate-progs/tex/context/third/literateProgs/t-literate-progs.mkiv'
))

tInsert(installTargets, target(
  't-literate-progs/tex/context/third/literateProgs/t-literate-progs.lua',
  'build/t-literate-progs.lua',
  'cp build/t-literate-progs.lua t-literate-progs/tex/context/third/literateProgs/t-literate-progs.lua'
))

tInsert(installTargets, target(
  't-literate-progs/tex/context/third/literateProgs/t-literate-progs-templates.lua',
  'build/t-literate-progs-templates.lua',
  'cp build/t-literate-progs-templates.lua t-literate-progs/tex/context/third/literateProgs/t-literate-progs-templates.lua'
))

-------------------------------
-- ADD targets for the lakefile

tInsert(buildTargets, target(
  'build/lakefile',
  docFiles,
  contextDoc
))

tInsert(diffTargets, target(
  'diff-lakefile',
  'build/lakefile',
  'diff build/lakefile lakefile'
))

tInsert(installTargets, target(
  'lakefile',
  'build/lakefile',
 'cp build/lakefile lakefile'
))


-- some additional lake file items

target('install', installTargets)
target('diff', diffTargets)
default(buildTargets)